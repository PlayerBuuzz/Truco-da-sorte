<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>T√¥comfome üçî | Buscar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --laranja:#ff8c1a;
  --cinza:#f5f5f5;
  --texto:#333;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Arial}
body{background:var(--cinza)}
.header{
  background:var(--laranja);
  color:#fff;
  padding:14px;
  display:flex;
  align-items:center;
  gap:10px;
}
.menu-btn{font-size:1.4em;cursor:pointer}
.header input{
  flex:1;padding:10px;border:none;border-radius:10px
}
.usuario{font-size:.8em}
.sidebar{
  position:fixed;top:0;left:-260px;width:260px;height:100%;
  background:#fff;box-shadow:2px 0 10px rgba(0,0,0,.2);
  padding:20px;transition:.3s;z-index:10
}
.sidebar.active{left:0}
.lista{padding:15px}
.card{
  background:#fff;border-radius:14px;padding:15px;margin-bottom:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.08)
}
.preco{color:var(--laranja);font-weight:700}
.btn{
  margin-top:10px;width:100%;padding:10px;border:none;
  border-radius:10px;background:var(--laranja);color:#fff
}
</style>
</head>

<body>

<div class="sidebar" id="sidebar">
  <h3>üçî Categorias</h3>
  <a href="#">Hamb√∫rguer</a>
  <a href="#">Pizza</a>
</div>

<div class="header">
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <input placeholder="Buscar comida...">
  <div class="usuario" id="usuario">Visitante</div>
</div>

<div class="lista" id="listaProdutos"></div>

<script>
function toggleMenu(){
  document.getElementById("sidebar").classList.toggle("active");
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD6a29L24aFSgVjmC7NFGXpdWW4g1uQsio",
  authDomain: "tocomfome-754e1.firebaseapp.com",
  projectId: "tocomfome-754e1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const lista = document.getElementById("listaProdutos");
const usuarioEl = document.getElementById("usuario");

/* USU√ÅRIO NO TOPO */
onAuthStateChanged(auth, async (user)=>{
  if(user){
    const snap = await getDoc(doc(db,"clientes",user.uid));
    usuarioEl.innerText = snap.exists() ? snap.data().nome : "Usu√°rio";
  }else{
    usuarioEl.innerText = "Visitante";
  }
});

/* PRODUTOS */
async function carregarProdutos(){
  const comercios = await getDocs(collection(db,"comercios"));

  comercios.forEach(async comercioDoc=>{
    const comercio = comercioDoc.data();
    const produtos = await getDocs(collection(db,"comercios",comercioDoc.id,"produtos"));

    produtos.forEach(prodDoc=>{
      const p = prodDoc.data();
      lista.innerHTML += `
        <div class="card">
          <h4>${p.nome}</h4>
          <div class="preco">R$ ${Number(p.valor).toFixed(2)}</div>
          <div>${comercio.nome}</div>
          <button class="btn" onclick='pedir(${JSON.stringify(p)})'>
            Pedir
          </button>
        </div>
      `;
    });
  });
}

window.pedir = (produto)=>{
  localStorage.setItem("produtoSelecionado", JSON.stringify(produto));
  window.location.href = "produto.html";
};

carregarProdutos();
</script>
</body>
</html>
