<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>T√¥comfome | Meus Cupons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --laranja:#ff8c1a;
  --cinza:#f4f5f7;
  --branco:#ffffff;
  --texto:#333;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',Arial;
}

body{
  background:var(--cinza);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px;
}

.box{
  background:var(--branco);
  width:100%;
  max-width:450px;
  padding:24px;
  border-radius:20px;
  box-shadow:0 10px 24px rgba(0,0,0,.12);
}

h2{
  text-align:center;
  color:var(--laranja);
  margin-bottom:20px;
}

/* Lista */
.lista{
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* Card */
.cupom{
  background:#fafafa;
  border:1px solid #eee;
  border-radius:14px;
  padding:14px;
}

.cupom h3{
  color:#222;
  font-size:1.1em;
}

.cupom p{
  font-size:.85em;
  color:#555;
  margin-top:4px;
}

/* Status */
.ativo{
  color:green;
  font-weight:600;
}

.inativo{
  color:red;
  font-weight:600;
}

/* Mensagem vazia */
.vazio{
  text-align:center;
  color:#777;
  font-size:.9em;
  padding:30px 10px;
}

/* Bot√£o */
.voltar{
  margin-top:20px;
  text-align:center;
  font-size:.9em;
  color:#666;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box">

  <h2>üéüÔ∏è Meus Cupons</h2>

  <div id="lista" class="lista"></div>

  <div class="voltar" onclick="history.back()">‚Üê Voltar</div>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import {
  getFirestore,
  collection,
  getDocs,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD6a29L24aFSgVjmC7NFGXpdWW4g1uQsio",
  authDomain: "tocomfome-754e1.firebaseapp.com",
  projectId: "tocomfome-754e1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


/* COM√âRCIO */
const comercio = JSON.parse(localStorage.getItem("comercioSelecionado"));

if(!comercio || !comercio.comercioId){
  alert("Com√©rcio n√£o identificado.");
  location.href = "/comercio/painel.html";
}


/* CARREGAR CUPONS */
async function carregarCupons(){

  const lista = document.getElementById("lista");

  try{

    const ref = collection(
      db,
      "comercios",
      comercio.comercioId,
      "cupons"
    );

    const q = query(ref, orderBy("criadoEm","desc"));

    const snapshot = await getDocs(q);

    /* Se n√£o tiver cupom */
    if(snapshot.empty){

      lista.innerHTML = `
        <div class="vazio">
          üòï Nenhum cupom criado ainda
        </div>
      `;
      return;
    }

    /* Se tiver */
    snapshot.forEach(doc=>{

      const c = doc.data();

      const status = c.ativo
        ? '<span class="ativo">Ativo</span>'
        : '<span class="inativo">Inativo</span>';

      const div = document.createElement("div");
      div.className = "cupom";

      div.innerHTML = `
        <h3>${c.nome}</h3>
        <p>üí∞ Desconto: ${c.desconto}%</p>
        <p>üìÖ Validade: ${formatarData(c.validade)}</p>
        <p>Status: ${status}</p>
      `;

      lista.appendChild(div);

    });


  }catch(e){

    console.error(e);

    lista.innerHTML = `
      <div class="vazio">
        ‚ùå Erro ao carregar cupons
      </div>
    `;

  }

}


/* FORMATAR DATA */
function formatarData(data){

  if(!data) return "-";

  const d = new Date(data);

  return d.toLocaleDateString("pt-BR");

}


/* INICIAR */
carregarCupons();

</script>

</body>
</html>
